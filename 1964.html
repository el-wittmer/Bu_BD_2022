<!DOCTYPE html>
<script src="https://d3js.org/d3.v5.min.js"></script>

<style>
* {
    color: #000;
    font-family: Palatino;
    margin-right: 5%;
    margin-left: 5%;
}
.button {
    margin-left: 0;
}
.link line {stroke: black;}
.node circle {stroke: black; fill: white;}
.node text {text-anchor: middle; font-size: 20px}
div.tooltip {	
    position: absolute;			
    text-align: left;			
    width: 400px;					
    height: 120px;					
    padding: 10px;				
    font: 14px Palatino;		
    background: salmon;	
    border: 5px;		
    border-radius: 8px;			
    pointer-events: none;			
}
</style>
<head>
<h1>Year One: 1964</h1>
</head>

<body onload='init()'>
    <p>In the first year of publication, Paul et al. (1963) gained sixteen citations. Most of these citations only cite Paul et al. (1963)
        (n = 12) but four of them cite both Paul et al. (1963) as well as one of its citing papers. </p>

    <p>Citations that don't include Paul et al. (1963) are restricted to their own topic, at this point in time. This means, for example, that caffeine papers cite caffeine papers or 
        physical activity papers cite physical activity papers. There is no connection between groups, meaning that a physical activity paper does not cite a caffeine paper.
    </p>

    <h3><span style="color: salmon; margin-left: 0">In cases where edges between items are ambiguously placed, dragging the 
        circles to a new position may help.</span></h3>

<svg width=600 height=400></svg>
<div id="tooltip" opacity=0></div>    

<script>
var svg = d3.select("svg")
width = +svg.attr("width"), 
height = +svg.attr("height");

async function init() {

    const test = await d3.json('https://raw.githubusercontent.com/el-wittmer/Paul_1963/main/Paul_1964.json');
    const color = ["red", 'orange', 'yellow', 'green', 'blue', 'pink', 'lightpurple', 'lightblue', 'gray', 'white'];

    var simulation = d3.forceSimulation()
    .force("link", d3.forceLink()
       .id(function(d) {return d.Id;}))
    .force("charge", d3.forceManyBody())
    .force("center",d3.forceCenter(width / 2, height / 2))
    .force("collide", d3.forceCollide(25));

    var nodes = test.nodes;
    simulation.nodes(nodes)

    var links = test.links;
    simulation.force("link").links(links);

    var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);

    var linksel = svg.append("g").attr("class", "link")
    .selectAll("line").data(links).enter().append("line")

    var nodesel = svg.selectAll(".node")
    .data(nodes)
    .enter().append("g")
    .attr("class", "node")
    .call(d3.drag()
    .on("start", dragstarted)
    .on("drag", dragged)
    .on("end", dragended));

    nodesel.append("circle")
    .attr("r", 20)
    .style("fill", function(d, i) {return color[d.Cluster]})
    .on("mouseover", function(d) {	
            div.transition()			
                .style("opacity", .9);		
            div	.html("First Author: " + d.First_Author +
                "<br>Title: " + d.Title + 
                "<br>Publication Year: " + d.Publication_Year + 
                "<br>Publication Source: " + d.Publication_Source + 
                "<br>Topic: " + d.Topic)
                .style("left", (d3.event.pageX) + "px")		
                .style("top", (d3.event.pageY) + "px");	
            })					
        .on("mouseout", function(d) {		
            div.transition()			
                .style("opacity", 0);	
        });

    nodesel.append("text")
    .attr("transform","translate(0,6)")
    .text(function (d) {return d.Id; });
    
    simulation.on("tick", ticked);

    function ticked() {
    linksel.attr("x1", function(d) { return d.source.x; })
    .attr("y1", function(d) { return d.source.y; })
    .attr("x2", function(d) { return d.target.x; })
    .attr("y2", function(d) { return d.target.y; });

    nodesel.attr("transform", function(d) {
    return "translate(" + d.x + "," + d.y + ")";
    });
    }
    function dragstarted(d) {
    if (!d3.event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
    }
    function dragged(d) {
    d.fx = d3.event.x;
    d.fy = d3.event.y;
    }
    function dragended(d) {
    if (!d3.event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
    }
}
</script>

<a href="http://el-wittmer.github.io/Paul_1963/"><button type="button" class="button">Publication: 1963</button></a>
<a href="http://el-wittmer.github.io/Paul_1963/1965"><button type="button" class="button">Year Two: 1965</button></a>
</body>
</html>
