<!DOCTYPE html>
<script src="https://d3js.org/d3.v5.min.js"></script>

<style>
* {
    color: #000;
    font-family: Palatino;
    margin-right: 5%;
    margin-left: 5%;
}
.button {
    margin-left: 0;
}
.link line {stroke: black;}
.node circle {stroke: black; fill: white}
.node text {text-anchor: middle; font-size: 20px}
div.tooltip {	
    position: absolute;			
    text-align: left;			
    width: 400px;					
    height: 110px;					
    padding: 10px;				
    font: 14px Palatino;		
    background: salmon;	
    border: 5px;		
    border-radius: 8px;			
    pointer-events: none;			
}
</style>
<head>
<h1>The First Year</h1>
</head>

<body onload='init()'>
    
    <p>Paul et al. (1964) gained 16 citations within its first year of publication, which is unusally high for the time. These 16 publications span 6 topics: Serum Cholesterol and Unspecified CHD (blue, n=1), Smoking (brown, n=2), Physical Activity (pink, n=3), Psychosocial factors (grey, n=3), and Caffeine (green, n=3). Four publications (in white) could not be placed into any category, either because they did not provide clear enough descriptions of causes and effects or because full text was not available for the publication. Uncategorized papers will be dropped from the graph from this point forward.</p>
    <p>The graph shows that out of all Paul et al.'s findings, at the onset of publication, only 6 topics were picked up immediately. Notice that the negative findings pertaining to lack of a connection between diet and CHD are so far not being picked up by the research community. Looking to the future and the first five years of publication, we start to see some diversity in publication topic. </p>

<svg width=600 height=400></svg>
<div id="tooltip" opacity=0></div>    

<script>
var svg = d3.select("svg")
width = +svg.attr("width"), 
height = +svg.attr("height");

async function init() {

    const test = await d3.json('https://raw.githubusercontent.com/el-wittmer/Paul_1963/main/Paul_1964.json');
    const color = ["blue", 'light blue', 'green', 'red', 'yellow', 'pink', 'orange', 'gray', 'brown', 'white']

    var simulation = d3.forceSimulation()
    .force("link", d3.forceLink()
       .id(function(d) {return d.Id;}))
    .force("charge", d3.forceManyBody())
    .force("center",d3.forceCenter(width / 2, height / 2))
    .force("collide", d3.forceCollide(35));

    var nodes = test.nodes;
    simulation.nodes(nodes)

    var links = test.links;
    simulation.force("link").links(links);

    var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);

    var linksel = svg.append("g").attr("class", "link")
    .selectAll("line").data(links).enter().append("line")

    var nodesel = svg.selectAll(".node")
    .data(nodes)
    .enter().append("g")
    .attr("class", "node")
    .call(d3.drag()
    .on("start", dragstarted)
    .on("drag", dragged)
    .on("end", dragended));

    nodesel.append("circle")
    .attr("r", 20)
    .style("fill", function(d, i) {return color[d.Cluster]})
    .on("mouseover", function(d) {	
            div.transition()			
                .style("opacity", .9);		
            div	.html("First Author: " + d.First_Author +
                "<br>Title: " + d.Title + 
                "<br>Publication Year: " + d.Publication_Year + 
                "<br>Publication Source: " + d.Publication_Source + 
                "<br>Topic: " + d.Topic)
                .style("left", (d3.event.pageX) + "px")		
                .style("top", (d3.event.pageY) + "px");	
            })			
        .on("mouseout", function(d) {		
            div.transition()			
                .style("opacity", 0);	
        });

    nodesel.append("text")
    .attr("transform","translate(0,6)")
    .text(function (d) {return d.Id; });
    
    simulation.on("tick", ticked);

    function ticked() {
    linksel.attr("x1", function(d) { return d.source.x; })
    .attr("y1", function(d) { return d.source.y; })
    .attr("x2", function(d) { return d.target.x; })
    .attr("y2", function(d) { return d.target.y; });

    nodesel.attr("transform", function(d) {
    return "translate(" + d.x + "," + d.y + ")";
    });
    }
    function dragstarted(d) {
    if (!d3.event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
    }
    function dragged(d) {
    d.fx = d3.event.x;
    d.fy = d3.event.y;
    }
    function dragended(d) {
    if (!d3.event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
    }
}
</script>

<a href="http://el-wittmer.github.io/Paul_1963/"><button type="button" class="button">Backward to 1963</button></a>
<a href="http://el-wittmer.github.io/Paul_1963/1969"><button type="button" class="button">Forward to 1969</button></a>
</body>
</html>
